#!/usr/bin/env ruby

puts "ğŸ§ª SpouÅ¡tÃ­m kompletnÃ­ test suite pro Mini CRM"
puts "=" * 50

# Change to the right directory
require "pathname"
ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../Gemfile", __dir__)

require "bundler/setup" # Set up gems listed in the Gemfile.

# Set test environment
ENV["RAILS_ENV"] = "test"

def run_test_command(name, command)
  puts "\nğŸ” #{name}"
  puts "-" * 30
  
  start_time = Time.now
  success = system(command)
  end_time = Time.now
  
  duration = (end_time - start_time).round(2)
  
  if success
    puts "âœ… #{name} - dokonÄeno za #{duration}s"
  else
    puts "âŒ #{name} - SELHALO za #{duration}s"
  end
  
  success
end

# Track overall results
results = {}

# Prepare test database
puts "\nğŸ—ï¸  PÅ™Ã­prava test databÃ¡ze..."
system("bin/rails db:test:prepare")

# Run different test suites
results[:models] = run_test_command(
  "Model testy", 
  "bin/rails test test/models/"
)

results[:controllers] = run_test_command(
  "Controller testy", 
  "bin/rails test test/controllers/"
)

results[:components] = run_test_command(
  "Component testy", 
  "bin/rails test test/components/"
)

results[:system] = run_test_command(
  "System testy (E2E)", 
  "bin/rails test:system"
)

# Summary
puts "\n" + "=" * 50
puts "ğŸ“Š SOUHRN TESTÅ®"
puts "=" * 50

all_passed = true
results.each do |test_type, passed|
  status = passed ? "âœ… PROÅ LY" : "âŒ SELHALY"
  puts "#{test_type.to_s.capitalize.ljust(15)} #{status}"
  all_passed = false unless passed
end

puts "\nğŸ¯ CELKOVÃ VÃSLEDEK: #{all_passed ? 'âœ… VÅ ECHNY TESTY PROÅ LY' : 'âŒ NÄšKTERÃ‰ TESTY SELHALY'}"

if all_passed
  puts "\nğŸ‰ SkvÄ›lÃ¡ prÃ¡ce! Aplikace je plnÄ› otestovÃ¡na a funkÄnÃ­."
else
  puts "\nğŸ”§ Zkontrolujte selhavÅ¡Ã­ testy a opravte problÃ©my."
  exit 1
end 